import json

# ==============================================================================
# いじめ対応支援AI 知識データベース (law_data.py)
# ==============================================================================

# ------------------------------------------------------------------------------
# 1. いじめ防止対策推進法（平成25年法律第71号）
# ------------------------------------------------------------------------------
IJIME_PREVENTION_ACT_FULL_TEXT = """
別添3 いじめ防止対策推進法（平成25年法律第71号）：文部科学省
いじめ防止対策推進法
目次
第一章 総則（第一条―第十条）
第二章 いじめ防止基本方針等（第十一条―第十四条）
第三章 基本的施策（第十五条―第二十一条）
第四章 いじめの防止等に関する措置（第二十二条―第二十七条）
第五章 重大事態への対処（第二十八条―第三十三条）
第六章 雑則（第三十四条・第三十五条）
附則

第一章 総則
（目的）
第一条 この法律は、いじめが、いじめを受けた児童等の教育を受ける権利を著しく侵害し、その心身の健全な成長及び人格の形成に重大な影響を与えるのみならず、その生命又は身体に重大な危険を生じさせるおそれがあるものであることに鑑み、児童等の尊厳を保持するため、いじめの防止等（いじめの防止、いじめの早期発見及びいじめへの対処をいう。以下同じ。）のための対策に関し、基本理念を定め、国及び地方公共団体の責務を明らかにし、並びにいじめの防止等のための対策に関する基本的な方針の策定について定めることにより、いじめの防止等のための対策を総合的かつ効果的に推進することを目的とする。

（定義）
第二条 この法律において「いじめ」とは、児童等に対して、当該児童等が在籍する学校に在籍している等当該児童等と一定の人的関係にある他の児童等が行う心理的又は物理的な影響を与える行為（インターネットを通じて行われるものを含む。）であって、当該行為の対象となった児童等が心身の苦痛を感じているものをいう。
２ この法律において「学校」とは、学校教育法（昭和二十二年法律第二十六号）第一条に規定する小学校、中学校、高等学校、中等教育学校及び特別支援学校（幼稚園を除く。）をいう。
３ この法律において「児童等」とは、学校に在籍する児童又は生徒をいう。
４ この法律において「保護者」とは、親権を行う者（親権を行う者のないときは、未成年後見人）をいう。

（基本理念）
第三条 いじめの防止等のための対策は、いじめが全ての児童等に関係する問題であることに鑑み、児童等が安心して学習その他の活動に取り組むことができるよう、学校の内外を問わずいじめが行われなくなるようにすることを旨として行われなければならない。
（以下、国の責務、地方公共団体の責務、学校の設置者の責務、学校及び教職員の責務、保護者の責務等が続く）
"""

# ------------------------------------------------------------------------------
# 2. 平成29年 通知
# ------------------------------------------------------------------------------
NOTIFICATION_REVISION_2017 = """
平成29年3月16日「いじめの防止等のための基本的な方針」の改定及び「いじめの重大事態の調査に関するガイドライン」の策定について（通知）
検討の結果を踏まえ、別添の通り改定を行いました。
"""

# ------------------------------------------------------------------------------
# 3. いじめ防止基本方針
# ------------------------------------------------------------------------------
BASIC_POLICY_ON_BULLYING = """
いじめの防止等のための基本的な方針（最終改定 平成29年3月14日）
いじめの定義：個々の行為が「いじめ」に当たるか否かの判断は，表面的・形式的にすることなく，いじめられた児童生徒の立場に立つことが必要である。
いじめの解消定義：①いじめに係る行為が止んでいること（3か月目安）②被害児童生徒が心身の苦痛を感じていないこと。
重大事態：生命心身財産への重大被害、または年間30日目安の欠席。申立てがあれば「疑い」の段階で調査を開始する義務。
"""

# ------------------------------------------------------------------------------
# 4. 基本方針改定ポイント
# ------------------------------------------------------------------------------
BASIC_POLICY_REVISION_POINTS = """
「いじめの防止等のための基本的な方針」の改定について（平成29年3月）
・いじめの定義の解釈明確化（けんかやふざけ合いも被害性に着目）
・教職員の抱え込み禁止と組織的対応の徹底
・いじめの解消の2要件の厳格化
"""

# ------------------------------------------------------------------------------
# 5. 重大事態調査ガイドライン（平成29年）
# ------------------------------------------------------------------------------
bullying_major_incident_guideline = {
    "title": "いじめの重大事態の調査に関するガイドライン",
    "date": "平成29年3月",
    "publisher": "文部科学省",
    "summary": "事実の全容解明と同種の再発防止が目的。軽々に「いじめはなかった」と判断しないこと。"
}

# ------------------------------------------------------------------------------
# 6. 生徒指導提要（構成）
# ------------------------------------------------------------------------------
student_guidance_structure = {
    "title": "生徒指導提要（改訂版）構成",
    "chapters": ["第4章 いじめ", "第8章 自殺", "第10章 不登校"]
}

# ------------------------------------------------------------------------------
# 7. 生徒指導提要（詳細）
# ------------------------------------------------------------------------------
student_guidance_guidelines = {
    "title": "生徒指導提要（改訂版）詳細",
    "bullying": "被害者の主観重視。チーム学校での対応。情報の共有徹底（抱え込み厳禁）。",
    "suicide_prevention": "TALKの原則（Tell, Ask, Listen, Keep safe）。"
}

# ------------------------------------------------------------------------------
# 8. 生徒指導提要（改定履歴）
# ------------------------------------------------------------------------------
student_guidance_revision_history = [
    {"version": "改訂版", "date": "2022-12-06", "content": "こども基本法の理念等を反映"}
]

# ------------------------------------------------------------------------------
# 9. 重大事態調査ガイドライン（令和6年最新版）
# ------------------------------------------------------------------------------
bullying_major_incident_guidelines_2024 = {
    "title": "いじめの重大事態の調査に関するガイドライン（令和6年8月最新版）",
    "recognition": "申立てがあれば、学校がどう思おうと重大事態として調査する義務がある。",
    "explanation": "被害者・保護者への説明義務。不開示（黒塗り）は最小限にする。",
    "third_party": "中立性・公平性の確保。専門家（弁護士等）の活用。"
}

# ------------------------------------------------------------------------------
# 10. こども基本法（令和4年法律第77号）
# ------------------------------------------------------------------------------
CHILDREN_BASIC_ACT = """
こども基本法（施行：令和5年4月1日）
第三条（基本理念）：全てのこどもについて、その意見が尊重され、その最善の利益が優先して考慮されること。（意見表明権・こどもの最善の利益）
第十一条：こども施策の策定・評価に当たり、こどもや養育者の意見を反映させる措置を講ずること。
"""

# ------------------------------------------------------------------------------
# 11. 個人情報の取扱いQ&A（黒塗り対策）
# ------------------------------------------------------------------------------
PERSONAL_INFO_QA = """
学校における個人情報の取扱いに関するQ&A
・加害者の情報であっても、被害事実の認定に不可欠なものは開示すべき。
・安易に「個人情報保護」や「指導への支障」を理由に黒塗りにしてはならない。
・事実関係（いつ、誰が、何をしたか）は被害者側に正確に伝える義務がある。
"""

# ------------------------------------------------------------------------------
# 12. 不登校支援・教育機会確保法（出席扱い等）
# ------------------------------------------------------------------------------
TRUANCY_SUPPORT_DATA = """
文部科学省「不登校児童生徒への支援の在り方について（通知）」（令和元年10月25日）および「教育機会確保法」抜粋
・不登校は問題行動ではない。どの児童生徒にも起こり得る。
・支援の目標は「学校復帰」のみではなく「社会的自立」である。
・無理な登校刺激を避け、休養の必要性を認めること（教育機会確保法第13条）。
・自宅学習（ICT等活用）の出席扱い：要件を満たせば、校長の判断で「出席扱い」にし、評価（成績）に反映できる。
"""


# ==============================================================================
# 【最終処理】全てのデータを結合して、AIが読めるテキスト(PROMPT_TEXT)を作成する
# ==============================================================================

def to_str(data):
    if isinstance(data, str):
        return data
    return json.dumps(data, ensure_ascii=False, indent=2)

PROMPT_TEXT = f"""
以下は、いじめ対応において参照すべき重要な法令とガイドラインのデータベースです。
AIはこの内容を知識ベースとして、厳密に法的根拠に基づいた回答を行ってください。

【資料1：いじめ防止対策推進法（全文）】
{IJIME_PREVENTION_ACT_FULL_TEXT}

【資料2：通知（平成29年改定）】
{NOTIFICATION_REVISION_2017}

【資料3：いじめ防止基本方針】
{BASIC_POLICY_ON_BULLYING}

【資料4：改定ポイント】
{BASIC_POLICY_REVISION_POINTS}

【資料5：重大事態調査ガイドライン（平成29年）】
{to_str(bullying_major_incident_guideline)}

【資料6：生徒指導提要（構成）】
{to_str(student_guidance_structure)}

【資料7：生徒指導提要（詳細・最重要）】
{to_str(student_guidance_guidelines)}

【資料8：生徒指導提要（改定履歴）】
{to_str(student_guidance_revision_history)}

【資料9：重大事態調査ガイドライン（令和6年最新版・最重要）】
{to_str(bullying_major_incident_guidelines_2024)}

【資料10：こども基本法（重要：こどもの権利・意見表明）】
{CHILDREN_BASIC_ACT}

【資料11：個人情報の取扱いQ&A（黒塗り対策）】
{PERSONAL_INFO_QA}

【資料12：不登校支援・教育機会確保法（出席扱い等）】
{TRUANCY_SUPPORT_DATA}
"""